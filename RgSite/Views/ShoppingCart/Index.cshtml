@model RgSite.ViewModels.ShoppingCartViewModel



<div class="container">

    <!--Cart Items Table-->
    <div class="row table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th></th>
                    <th class="item-header">PRODUCT</th>
                    <th class="item-header">PRICE</th>
                    <th class="item-header">SIZE</th>
                    <th class="item-header">QUANTITY</th>
                    <th class="item-header">TOTAL</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.CartItems)
                {
                    <tr class="item-row">
                        <td class="">
                            <a asp-controller="Products" asp-action="ProductDetail" asp-route-id="@item.Id">
                                <div class="item-image" style="background-image: url(@item.ImageUrl)"></div>
                            </a>
                        </td>
                        <td class="item">@item.Name</td>
                        <td class="item">@item.DisplayPrice</td>
                        <td class="item">@item.DisplaySize</td>
                        <td class="item">
                            <input id="item-quantity" asp-for="@item.Quantity" onchange="onQuantityChanged(@item.Id, @item.Price.Id)" class="form-control col-sm-4" />
                        </td>
                        <td class="item" id="total">@item.DisplayTotal</td>
                        <td class="item">
                            <i>
                                <a id="delete-item" class="far fa-trash-alt pull-right" role="button" onclick="onDelete(event, @item.Id)" asp-controller="ShoppingCart" asp-action="RemoveFromCart" asp-route-id="@item.Id"></a>
                            </i>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


<style>
    .container {
        padding-top: 15px;
    }

    .item-image {
        height: 120px;
        width: 120px;
        background-size: 100%;
    }

    .table {
        font-family: 'Lato', Arial, sans-serif;
    }

    .item-header {
        font-weight: 900 !important;
    }

    .item {
        font-size: 18px;
        font-weight: 600;
        vertical-align: middle !important;
    }

    #delete-item {
        color: red;
    }
</style>

@section scripts
{
    <script>

        function onQuantityChanged(id, sizeId) {
            var selectedQuantity = $('#item-quantity').val();
            $.getJSON('/ShoppingCart/UpdateCart', { productId: id, selectedSizeId: sizeId, selectedQuantity: selectedQuantity  }, function(json) {
                $('#total').text(json.price);
            });
        }

        // Need to pass itemId here because for some reason if you dont, the the id of the first item in the cart is always passed.
       // if you dont show a popup, then the correct id is passed to the action in the controller
        function onDelete(e, itemId) {
            e.preventDefault();

            var tempUrl = $("#delete-item").attr('href');
            var url = tempUrl.replace(/\d+/g, itemId);

            Swal.fire({
                title: 'Are you sure?',
                text: "Item will be permanently removed.",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.value) {
                    window.location.href = url;
                }
            })
        }

    </script>
}